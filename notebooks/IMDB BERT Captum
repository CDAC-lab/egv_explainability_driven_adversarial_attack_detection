{"nbformat":4,"nbformat_minor":0,"metadata":{"orig_nbformat":2,"file_extension":".py","mimetype":"text/x-python","name":"python","npconvert_exporter":"python","pygments_lexer":"ipython3","version":3,"kernelspec":{"name":"python3","display_name":"Python 3"},"colab":{"provenance":[{"file_id":"1snFbxdVDtL3JEFW7GNfRs1PZKgNHfoNz","timestamp":1674303433353}],"machine_shape":"hm"},"accelerator":"TPU","gpuClass":"standard","widgets":{"application/vnd.jupyter.widget-state+json":{"3980b7918b604d3abdaccf7993f58c6f":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_bf87b65c7a56475fa4b798d32d12a3f9","IPY_MODEL_f7dbd6a7d7734f60aecd34801a3abe73","IPY_MODEL_8b66f785a4d14f7486c209a92b52c763"],"layout":"IPY_MODEL_7c6ec7f4d39440ad9e915bbeaa7c12e3"}},"bf87b65c7a56475fa4b798d32d12a3f9":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_54d92056641b425e8c893dab49928ef5","placeholder":"​","style":"IPY_MODEL_feae91270a7c4b859b37cda86a853eec","value":"Downloading: 100%"}},"f7dbd6a7d7734f60aecd34801a3abe73":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_f4dfe808b3524acf95354aa6d7a620b0","max":28,"min":0,"orientation":"horizontal","style":"IPY_MODEL_4dfef9efd82a4499bcfeba42baa2e2d2","value":28}},"8b66f785a4d14f7486c209a92b52c763":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_a5a4057198c1406a962b5920c11e94e7","placeholder":"​","style":"IPY_MODEL_59ed8064640648da8cc3b66bcb7f8278","value":" 28.0/28.0 [00:00&lt;00:00, 1.94kB/s]"}},"7c6ec7f4d39440ad9e915bbeaa7c12e3":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"54d92056641b425e8c893dab49928ef5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"feae91270a7c4b859b37cda86a853eec":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"f4dfe808b3524acf95354aa6d7a620b0":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"4dfef9efd82a4499bcfeba42baa2e2d2":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"a5a4057198c1406a962b5920c11e94e7":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"59ed8064640648da8cc3b66bcb7f8278":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"4c8309d4974a4d538efdc0ad6e4feea2":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_6ea6cd91413c4fdfbde10752e493081e","IPY_MODEL_5093ea5760714e65a7074e1383e6f69e","IPY_MODEL_2ca75132f4e747ccac18314e65ad0507"],"layout":"IPY_MODEL_70d035f2072c4e4498117493a5027552"}},"6ea6cd91413c4fdfbde10752e493081e":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_bb0c9d0aed124b449e643ebb2f861127","placeholder":"​","style":"IPY_MODEL_ecb66b270dc04976a2b1b3edc5161c21","value":"Downloading: 100%"}},"5093ea5760714e65a7074e1383e6f69e":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_d283ce67fca8411ba6f4b65b72ca6cb0","max":570,"min":0,"orientation":"horizontal","style":"IPY_MODEL_95e936f0280b43d29b08c792d7f5507b","value":570}},"2ca75132f4e747ccac18314e65ad0507":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_3be520b706844846a3bd3739351fd2f6","placeholder":"​","style":"IPY_MODEL_218cd706f0954354aab4e2ff4a654298","value":" 570/570 [00:00&lt;00:00, 40.2kB/s]"}},"70d035f2072c4e4498117493a5027552":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"bb0c9d0aed124b449e643ebb2f861127":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ecb66b270dc04976a2b1b3edc5161c21":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"d283ce67fca8411ba6f4b65b72ca6cb0":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"95e936f0280b43d29b08c792d7f5507b":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"3be520b706844846a3bd3739351fd2f6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"218cd706f0954354aab4e2ff4a654298":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a95f348e4ef54f8198a1ce986a129082":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_f64a29b12e2b4837ab7986cabb0bcbf1","IPY_MODEL_9268aa27076c44e29aaf3dde8efbc653","IPY_MODEL_10a416c04a7443f7a981d06a2031831a"],"layout":"IPY_MODEL_5347af2738ed4cbd88e2ae5fc54adc16"}},"f64a29b12e2b4837ab7986cabb0bcbf1":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_f25cc36a92af47c6bbdc864f622d1ccc","placeholder":"​","style":"IPY_MODEL_74e4585c33294a98963f845b163921d4","value":"Downloading: 100%"}},"9268aa27076c44e29aaf3dde8efbc653":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_eca5878c486046cb898b15723fff22be","max":231508,"min":0,"orientation":"horizontal","style":"IPY_MODEL_274c10ca66ef45659d51c74abfc4daaf","value":231508}},"10a416c04a7443f7a981d06a2031831a":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_3a519db8708a4e3bb60ddaacdaa6bb37","placeholder":"​","style":"IPY_MODEL_92c697cde15f488cbc99e448e5143cd8","value":" 232k/232k [00:00&lt;00:00, 1.83MB/s]"}},"5347af2738ed4cbd88e2ae5fc54adc16":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f25cc36a92af47c6bbdc864f622d1ccc":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"74e4585c33294a98963f845b163921d4":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"eca5878c486046cb898b15723fff22be":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"274c10ca66ef45659d51c74abfc4daaf":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"3a519db8708a4e3bb60ddaacdaa6bb37":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"92c697cde15f488cbc99e448e5143cd8":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"d5d5f0a6082e44f0ac76351c48456d2b":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_6ebd0d01b05c4760a3b7c234dbc0470d","IPY_MODEL_80d1052f71414aaa8c13281d8a2f140b","IPY_MODEL_c53d2fb9adaf48f7a8b74c986883c9fc"],"layout":"IPY_MODEL_28f39b1713b84f92b6926ad286d9e1d5"}},"6ebd0d01b05c4760a3b7c234dbc0470d":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_cdb7fb222fad4fffb07fe93c4216b97d","placeholder":"​","style":"IPY_MODEL_2c9b0e12a90a40f7b7149cf225dabe33","value":"Downloading: 100%"}},"80d1052f71414aaa8c13281d8a2f140b":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_e2dc26a8977241de99a141f48c2b0b95","max":466062,"min":0,"orientation":"horizontal","style":"IPY_MODEL_89e445fbe23a49c0a251664580406c00","value":466062}},"c53d2fb9adaf48f7a8b74c986883c9fc":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_c51f9069765a4364b0332a17f4a2618a","placeholder":"​","style":"IPY_MODEL_58613d3ad2a54c3bbd4659c68d0e844d","value":" 466k/466k [00:00&lt;00:00, 1.30MB/s]"}},"28f39b1713b84f92b6926ad286d9e1d5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"cdb7fb222fad4fffb07fe93c4216b97d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"2c9b0e12a90a40f7b7149cf225dabe33":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"e2dc26a8977241de99a141f48c2b0b95":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"89e445fbe23a49c0a251664580406c00":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"c51f9069765a4364b0332a17f4a2618a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"58613d3ad2a54c3bbd4659c68d0e844d":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"markdown","metadata":{"id":"UFESEuEgbUDD"},"source":["# Interpretation of BertForSequenceClassification in captum\n","\n","In this notebook we use Captum to interpret a BERT sentiment classifier finetuned on the imdb dataset https://huggingface.co/lvwerra/bert-imdb "]},{"cell_type":"code","metadata":{"id":"EJ51JAxHbghp","colab":{"base_uri":"https://localhost:8080/"},"outputId":"ae5d072a-ab61-4301-a5a2-71d91cdd7c41","executionInfo":{"status":"ok","timestamp":1674571344139,"user_tz":-660,"elapsed":14972,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["# Install dependencies\n","!pip install transformers\n","!pip install captum"],"execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting transformers\n","  Downloading transformers-4.25.1-py3-none-any.whl (5.8 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m5.8/5.8 MB\u001b[0m \u001b[31m44.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: requests in /usr/local/lib/python3.8/dist-packages (from transformers) (2.25.1)\n","Requirement already satisfied: pyyaml>=5.1 in /usr/local/lib/python3.8/dist-packages (from transformers) (6.0)\n","Requirement already satisfied: tqdm>=4.27 in /usr/local/lib/python3.8/dist-packages (from transformers) (4.64.1)\n","Collecting tokenizers!=0.11.3,<0.14,>=0.11.1\n","  Downloading tokenizers-0.13.2-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (7.6 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m7.6/7.6 MB\u001b[0m \u001b[31m69.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.8/dist-packages (from transformers) (21.3)\n","Requirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.8/dist-packages (from transformers) (1.21.6)\n","Collecting huggingface-hub<1.0,>=0.10.0\n","  Downloading huggingface_hub-0.11.1-py3-none-any.whl (182 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m182.4/182.4 KB\u001b[0m \u001b[31m13.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: filelock in /usr/local/lib/python3.8/dist-packages (from transformers) (3.9.0)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.8/dist-packages (from transformers) (2022.6.2)\n","Requirement already satisfied: typing-extensions>=3.7.4.3 in /usr/local/lib/python3.8/dist-packages (from huggingface-hub<1.0,>=0.10.0->transformers) (4.4.0)\n","Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /usr/local/lib/python3.8/dist-packages (from packaging>=20.0->transformers) (3.0.9)\n","Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.8/dist-packages (from requests->transformers) (1.24.3)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.8/dist-packages (from requests->transformers) (2022.12.7)\n","Requirement already satisfied: chardet<5,>=3.0.2 in /usr/local/lib/python3.8/dist-packages (from requests->transformers) (4.0.0)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.8/dist-packages (from requests->transformers) (2.10)\n","Installing collected packages: tokenizers, huggingface-hub, transformers\n","Successfully installed huggingface-hub-0.11.1 tokenizers-0.13.2 transformers-4.25.1\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting captum\n","  Downloading captum-0.6.0-py3-none-any.whl (1.3 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m1.3/1.3 MB\u001b[0m \u001b[31m17.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: torch>=1.6 in /usr/local/lib/python3.8/dist-packages (from captum) (1.13.1+cu116)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.8/dist-packages (from captum) (1.21.6)\n","Requirement already satisfied: matplotlib in /usr/local/lib/python3.8/dist-packages (from captum) (3.2.2)\n","Requirement already satisfied: typing-extensions in /usr/local/lib/python3.8/dist-packages (from torch>=1.6->captum) (4.4.0)\n","Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->captum) (1.4.4)\n","Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->captum) (3.0.9)\n","Requirement already satisfied: python-dateutil>=2.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->captum) (2.8.2)\n","Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.8/dist-packages (from matplotlib->captum) (0.11.0)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.8/dist-packages (from python-dateutil>=2.1->matplotlib->captum) (1.15.0)\n","Installing collected packages: captum\n","Successfully installed captum-0.6.0\n"]}]},{"cell_type":"code","source":["from google.colab import drive\n","drive.mount('/content/drive')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"hmg7Pem6Q6ON","executionInfo":{"status":"ok","timestamp":1674571370255,"user_tz":-660,"elapsed":26123,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"91f74c43-444b-4cec-a13b-cd5ac1d33977"},"execution_count":2,"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}]},{"cell_type":"code","metadata":{"id":"CS9Kaz8ubUDG","executionInfo":{"status":"ok","timestamp":1674571376291,"user_tz":-660,"elapsed":6053,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["from transformers import BertTokenizer, BertForSequenceClassification, BertConfig\n","from captum.attr import visualization as viz\n","from captum.attr import IntegratedGradients, LayerConductance, LayerIntegratedGradients\n","from captum.attr import configure_interpretable_embedding_layer, remove_interpretable_embedding_layer\n","import torch\n","import matplotlib.pyplot as plt"],"execution_count":3,"outputs":[]},{"cell_type":"code","metadata":{"id":"P1yl1gdvbUDS","executionInfo":{"status":"ok","timestamp":1674571376292,"user_tz":-660,"elapsed":15,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["device = torch.device(\"cuda:0\" if torch.cuda.is_available() else \"cpu\")"],"execution_count":4,"outputs":[]},{"cell_type":"code","source":["from transformers import AutoTokenizer, AutoModelForSequenceClassification\n","tokenizer = AutoTokenizer.from_pretrained(\"bert-base-uncased\")\n","path = '/content/drive/MyDrive/phd/models/imdb/language_models/bert-imdb-finetune'\n","model = AutoModelForSequenceClassification.from_pretrained(path)\n","model.to(device)\n","model.eval()\n","model.zero_grad()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":145,"referenced_widgets":["3980b7918b604d3abdaccf7993f58c6f","bf87b65c7a56475fa4b798d32d12a3f9","f7dbd6a7d7734f60aecd34801a3abe73","8b66f785a4d14f7486c209a92b52c763","7c6ec7f4d39440ad9e915bbeaa7c12e3","54d92056641b425e8c893dab49928ef5","feae91270a7c4b859b37cda86a853eec","f4dfe808b3524acf95354aa6d7a620b0","4dfef9efd82a4499bcfeba42baa2e2d2","a5a4057198c1406a962b5920c11e94e7","59ed8064640648da8cc3b66bcb7f8278","4c8309d4974a4d538efdc0ad6e4feea2","6ea6cd91413c4fdfbde10752e493081e","5093ea5760714e65a7074e1383e6f69e","2ca75132f4e747ccac18314e65ad0507","70d035f2072c4e4498117493a5027552","bb0c9d0aed124b449e643ebb2f861127","ecb66b270dc04976a2b1b3edc5161c21","d283ce67fca8411ba6f4b65b72ca6cb0","95e936f0280b43d29b08c792d7f5507b","3be520b706844846a3bd3739351fd2f6","218cd706f0954354aab4e2ff4a654298","a95f348e4ef54f8198a1ce986a129082","f64a29b12e2b4837ab7986cabb0bcbf1","9268aa27076c44e29aaf3dde8efbc653","10a416c04a7443f7a981d06a2031831a","5347af2738ed4cbd88e2ae5fc54adc16","f25cc36a92af47c6bbdc864f622d1ccc","74e4585c33294a98963f845b163921d4","eca5878c486046cb898b15723fff22be","274c10ca66ef45659d51c74abfc4daaf","3a519db8708a4e3bb60ddaacdaa6bb37","92c697cde15f488cbc99e448e5143cd8","d5d5f0a6082e44f0ac76351c48456d2b","6ebd0d01b05c4760a3b7c234dbc0470d","80d1052f71414aaa8c13281d8a2f140b","c53d2fb9adaf48f7a8b74c986883c9fc","28f39b1713b84f92b6926ad286d9e1d5","cdb7fb222fad4fffb07fe93c4216b97d","2c9b0e12a90a40f7b7149cf225dabe33","e2dc26a8977241de99a141f48c2b0b95","89e445fbe23a49c0a251664580406c00","c51f9069765a4364b0332a17f4a2618a","58613d3ad2a54c3bbd4659c68d0e844d"]},"id":"eN7Lqzb8RHy7","executionInfo":{"status":"ok","timestamp":1674571383346,"user_tz":-660,"elapsed":7067,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"b3c00cb2-07d3-48ca-a3db-7c4e73947308"},"execution_count":5,"outputs":[{"output_type":"display_data","data":{"text/plain":["Downloading:   0%|          | 0.00/28.0 [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"3980b7918b604d3abdaccf7993f58c6f"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading:   0%|          | 0.00/570 [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"4c8309d4974a4d538efdc0ad6e4feea2"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading:   0%|          | 0.00/232k [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"a95f348e4ef54f8198a1ce986a129082"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading:   0%|          | 0.00/466k [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"d5d5f0a6082e44f0ac76351c48456d2b"}},"metadata":{}}]},{"cell_type":"code","metadata":{"id":"JUMsvUOTbUDi","executionInfo":{"status":"ok","timestamp":1674571383347,"user_tz":-660,"elapsed":12,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["def predict(inputs):\n","    return model(inputs)[0]"],"execution_count":6,"outputs":[]},{"cell_type":"code","metadata":{"id":"SIbauwGbbUDo","executionInfo":{"status":"ok","timestamp":1674571383347,"user_tz":-660,"elapsed":10,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["ref_token_id = tokenizer.pad_token_id # A token used for generating token reference\n","sep_token_id = tokenizer.sep_token_id # A token used as a separator between question and text and it is also added to the end of the text.\n","cls_token_id = tokenizer.cls_token_id # A token used for prepending to the concatenated question-text word sequence"],"execution_count":7,"outputs":[]},{"cell_type":"code","metadata":{"id":"mcnTCNUFbUD1","executionInfo":{"status":"ok","timestamp":1674571383348,"user_tz":-660,"elapsed":9,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["def construct_input_ref_pair(text, ref_token_id, sep_token_id, cls_token_id):\n","\n","    text_ids = tokenizer.encode(text, add_special_tokens=False)\n","    # construct input token ids\n","    input_ids = [cls_token_id] + text_ids + [sep_token_id]\n","    # construct reference token ids \n","    ref_input_ids = [cls_token_id] + [ref_token_id] * len(text_ids) + [sep_token_id]\n","\n","    return torch.tensor([input_ids], device=device), torch.tensor([ref_input_ids], device=device), len(text_ids)\n","\n","def construct_input_ref_token_type_pair(input_ids, sep_ind=0):\n","    seq_len = input_ids.size(1)\n","    token_type_ids = torch.tensor([[0 if i <= sep_ind else 1 for i in range(seq_len)]], device=device)\n","    ref_token_type_ids = torch.zeros_like(token_type_ids, device=device)# * -1\n","    return token_type_ids, ref_token_type_ids\n","\n","def construct_input_ref_pos_id_pair(input_ids):\n","    seq_length = input_ids.size(1)\n","    position_ids = torch.arange(seq_length, dtype=torch.long, device=device)\n","    # we could potentially also use random permutation with `torch.randperm(seq_length, device=device)`\n","    ref_position_ids = torch.zeros(seq_length, dtype=torch.long, device=device)\n","\n","    position_ids = position_ids.unsqueeze(0).expand_as(input_ids)\n","    ref_position_ids = ref_position_ids.unsqueeze(0).expand_as(input_ids)\n","    return position_ids, ref_position_ids\n","    \n","def construct_attention_mask(input_ids):\n","    return torch.ones_like(input_ids)"],"execution_count":8,"outputs":[]},{"cell_type":"code","metadata":{"id":"vhasPia4bUD8","executionInfo":{"status":"ok","timestamp":1674571383623,"user_tz":-660,"elapsed":12,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["def custom_forward(inputs):\n","    preds = predict(inputs)\n","    return torch.softmax(preds, dim = 1)[0][1].unsqueeze(-1)"],"execution_count":9,"outputs":[]},{"cell_type":"code","metadata":{"id":"pGwkb1vAbUEA","executionInfo":{"status":"ok","timestamp":1674571383624,"user_tz":-660,"elapsed":12,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["lig = LayerIntegratedGradients(predict, model.bert.embeddings)"],"execution_count":10,"outputs":[]},{"cell_type":"code","source":["def interpret_sentence(text, true_label):\n","  input_ids, ref_input_ids, sep_id = construct_input_ref_pair(text, ref_token_id, sep_token_id, cls_token_id)\n","  token_type_ids, ref_token_type_ids = construct_input_ref_token_type_pair(input_ids, sep_id)\n","  position_ids, ref_position_ids = construct_input_ref_pos_id_pair(input_ids)\n","  attention_mask = construct_attention_mask(input_ids)\n","  indices = input_ids[0].detach().tolist()\n","  converted_tokens = tokenizer.convert_ids_to_tokens(indices)\n","  all_tokens = tokenizer.convert_ids_to_tokens(indices)\n","  attributions, delta = lig.attribute(inputs=input_ids,\n","                                    baselines=ref_input_ids,\n","                                    n_steps=150,\n","                                    return_convergence_delta=True, target=true_label)\n","  attributions = attributions.sum(dim=-1).squeeze(0)\n","  attributions = attributions / torch.norm(attributions)\n","  attributions = attributions.detach().tolist()\n","  return attributions, converted_tokens, true_label, true_label "],"metadata":{"id":"kcPkPizySztc","executionInfo":{"status":"ok","timestamp":1674571390779,"user_tz":-660,"elapsed":3,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"execution_count":13,"outputs":[]},{"cell_type":"code","source":["from textblob import TextBlob\n","\n","def spell_correct(input):\n","  str_input = TextBlob(input)\n","  return str_input.correct()"],"metadata":{"id":"8-x7tCOPPZFo","executionInfo":{"status":"ok","timestamp":1674571385557,"user_tz":-660,"elapsed":1942,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"execution_count":12,"outputs":[]},{"cell_type":"code","source":["def get_cleaned_lists(word_attributions, tokens):\n","  tokens_list = [] \n","  att_list = []\n","  index = 0\n","  for word, score in zip(tokens, word_attributions):\n","    if word == '[CLS]' or word == '[SEP]':\n","      continue\n","    tokens_list.append(word)\n","    att_list.append(score)\n","\n","  clean_token_list = []\n","  clean_att_list = []\n","  index = 0\n","\n","  while index < len(tokens_list):\n","    word = tokens_list[index]\n","    score = att_list[index]\n","    sub_word_list = []\n","    sub_score_list = []\n","    sub_word_list.append(word)\n","    sub_score_list.append(score)\n","    index = index + 1\n","    if index < (len(tokens_list) - 1):\n","      next_word = tokens_list[index]\n","      next_score = att_list[index]\n","      while next_word.startswith('##') and index < (len(tokens_list) - 1):\n","        sub_word_list.append(next_word.replace('##', ''))\n","        sub_score_list.append(next_score)\n","        index = index + 1\n","        next_word = tokens_list[index]\n","        next_score = att_list[index]\n","  \n","    clean_token_list.append(''.join(sub_word_list))\n","    clean_att_list.append(max(sub_score_list, key=abs))\n","  return clean_att_list, clean_token_list"],"metadata":{"id":"F-wQuOn9YFAl","executionInfo":{"status":"ok","timestamp":1674571395006,"user_tz":-660,"elapsed":422,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"execution_count":14,"outputs":[]},{"cell_type":"code","metadata":{"id":"EQlVDaISbUEF","executionInfo":{"status":"ok","timestamp":1674571076297,"user_tz":-660,"elapsed":14,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["# One can test a couple of examples and check that the sentiment classifier is behaving\n","text = \"The movie was one of those amazing movies\"\n","#text = \"The movie was one of those crappy movies you can't forget.\""],"execution_count":15,"outputs":[]},{"cell_type":"code","source":["interpret_sentence(text, 1)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"NSAyGeQzVuzd","executionInfo":{"status":"ok","timestamp":1674571076974,"user_tz":-660,"elapsed":689,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"9c1591be-d29c-450c-b09a-2c0d65040914"},"execution_count":16,"outputs":[{"output_type":"execute_result","data":{"text/plain":["([0.0,\n","  0.048870054086055034,\n","  -0.008681616156616724,\n","  -0.006197693598239816,\n","  0.05764838210396718,\n","  -0.043762986665131794,\n","  0.11355689665470009,\n","  0.9794903884118789,\n","  0.14128981286151007,\n","  0.0],\n"," ['[CLS]',\n","  'the',\n","  'movie',\n","  'was',\n","  'one',\n","  'of',\n","  'those',\n","  'amazing',\n","  'movies',\n","  '[SEP]'],\n"," 1,\n"," 1)"]},"metadata":{},"execution_count":16}]},{"cell_type":"code","source":["interpret_sentence(text, 0)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"NYZK_AVhW3EL","executionInfo":{"status":"ok","timestamp":1674305774123,"user_tz":-660,"elapsed":37470,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"dc0b82c0-5d52-41ce-be3d-27a9d1281888"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["tensor([[ 101, 1996, 3185, 2001, 2028, 1997, 2216, 6429, 5691,  102]])\n"]},{"output_type":"execute_result","data":{"text/plain":["tensor([ 0.0000, -0.0410, -0.0025,  0.0047, -0.0446,  0.0422, -0.1123, -0.9836,\n","        -0.1205,  0.0000], dtype=torch.float64)"]},"metadata":{},"execution_count":20}]},{"cell_type":"code","source":["import pandas as pd\n","import re\n","# data1 = pd.read_csv(\"/content/drive/MyDrive/phd/models/imdb/bert_imdb_attack_bae.csv\")\n","# data2 = pd.read_csv(\"/content/drive/MyDrive/phd/models/imdb/bert_imdb_attack_bae_1.csv\")\n","# data3 = pd.read_csv(\"/content/drive/MyDrive/phd/models/imdb/bert_imdb_attack_bae_2.csv\")\n","\n","data = pd.read_csv(\"/content/drive/MyDrive/phd/models/imdb/bert_imdb_attack_textfool.csv\")"],"metadata":{"id":"mBUsIi2Af7Ww","executionInfo":{"status":"ok","timestamp":1674571399758,"user_tz":-660,"elapsed":315,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"execution_count":15,"outputs":[]},{"cell_type":"code","source":["data"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":641},"id":"7tKyl5unPr-N","executionInfo":{"status":"ok","timestamp":1674571102812,"user_tz":-660,"elapsed":508,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"66f806fb-1e97-4a00-e7fb-ebbc85b822bd"},"execution_count":19,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                                          original_text  \\\n","0     The film had NO help at all, promotion-wise: i...   \n","1     People may say I am harsh but I can't [[help]]...   \n","2     I'm thinking of some things for this movie: Fi...   \n","3     I was kinda looking forward to Man of the Year...   \n","4     [[If]] you've ever listened to any of the Jame...   \n","...                                                 ...   \n","1086  [[Such]] pain! Pain in the [[shape]] that it [...   \n","1087  Getting Eaten By A Bunch Of Snakes Is More [[E...   \n","1088  This satire is just really, really dead-on, an...   \n","1089  Empire of Passion starts out deceptively - tha...   \n","1090  My wife and I watched this [[marvelous]] movie...   \n","\n","                                         perturbed_text  original_score  \\\n","0     The film had NO help at all, promotion-wise: i...        0.999296   \n","1     People may say I am harsh but I can't [[pomoc]...        0.000848   \n","2     I'm thinking of some things for this movie: Fi...        0.000607   \n","3     I was kinda looking forward to Man of the Year...        0.000658   \n","4     [[Despite]] you've ever listened to any of the...        0.000748   \n","...                                                 ...             ...   \n","1086  [[Comparable]] pain! Pain in the [[style]] tha...        0.000604   \n","1087  Getting Eaten By A Bunch Of Snakes Is More [[C...        0.001053   \n","1088  This satire is just really, really dead-on, an...        0.000993   \n","1089  Empire of Passion starts out deceptively - tha...        0.000703   \n","1090  My wife and I watched this [[sumptuous]] movie...        0.000539   \n","\n","      perturbed_score  original_output  perturbed_output  ground_truth_output  \\\n","0            0.999296                0                 0                    1   \n","1            0.766364                0                 1                    0   \n","2            0.867620                0                 1                    0   \n","3            0.770932                0                 1                    0   \n","4            0.725499                0                 1                    0   \n","...               ...              ...               ...                  ...   \n","1086         0.798727                0                 1                    0   \n","1087         0.651640                0                 1                    0   \n","1088         0.975886                1                 0                    1   \n","1089         0.937413                1                 0                    1   \n","1090         0.871588                1                 0                    1   \n","\n","      num_queries result_type  \n","0               1     Skipped  \n","1             330  Successful  \n","2             551  Successful  \n","3             603  Successful  \n","4             359  Successful  \n","...           ...         ...  \n","1086          546  Successful  \n","1087          508  Successful  \n","1088          260  Successful  \n","1089          183  Successful  \n","1090          321  Successful  \n","\n","[1091 rows x 9 columns]"],"text/html":["\n","  <div id=\"df-d16c2384-c3b4-47c0-8cbb-5646d62be869\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>original_text</th>\n","      <th>perturbed_text</th>\n","      <th>original_score</th>\n","      <th>perturbed_score</th>\n","      <th>original_output</th>\n","      <th>perturbed_output</th>\n","      <th>ground_truth_output</th>\n","      <th>num_queries</th>\n","      <th>result_type</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>The film had NO help at all, promotion-wise: i...</td>\n","      <td>The film had NO help at all, promotion-wise: i...</td>\n","      <td>0.999296</td>\n","      <td>0.999296</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>Skipped</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>People may say I am harsh but I can't [[help]]...</td>\n","      <td>People may say I am harsh but I can't [[pomoc]...</td>\n","      <td>0.000848</td>\n","      <td>0.766364</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>330</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>I'm thinking of some things for this movie: Fi...</td>\n","      <td>I'm thinking of some things for this movie: Fi...</td>\n","      <td>0.000607</td>\n","      <td>0.867620</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>551</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>I was kinda looking forward to Man of the Year...</td>\n","      <td>I was kinda looking forward to Man of the Year...</td>\n","      <td>0.000658</td>\n","      <td>0.770932</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>603</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>[[If]] you've ever listened to any of the Jame...</td>\n","      <td>[[Despite]] you've ever listened to any of the...</td>\n","      <td>0.000748</td>\n","      <td>0.725499</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>359</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>1086</th>\n","      <td>[[Such]] pain! Pain in the [[shape]] that it [...</td>\n","      <td>[[Comparable]] pain! Pain in the [[style]] tha...</td>\n","      <td>0.000604</td>\n","      <td>0.798727</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>546</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>1087</th>\n","      <td>Getting Eaten By A Bunch Of Snakes Is More [[E...</td>\n","      <td>Getting Eaten By A Bunch Of Snakes Is More [[C...</td>\n","      <td>0.001053</td>\n","      <td>0.651640</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>508</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>1088</th>\n","      <td>This satire is just really, really dead-on, an...</td>\n","      <td>This satire is just really, really dead-on, an...</td>\n","      <td>0.000993</td>\n","      <td>0.975886</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>260</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>1089</th>\n","      <td>Empire of Passion starts out deceptively - tha...</td>\n","      <td>Empire of Passion starts out deceptively - tha...</td>\n","      <td>0.000703</td>\n","      <td>0.937413</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>183</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>1090</th>\n","      <td>My wife and I watched this [[marvelous]] movie...</td>\n","      <td>My wife and I watched this [[sumptuous]] movie...</td>\n","      <td>0.000539</td>\n","      <td>0.871588</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>321</td>\n","      <td>Successful</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>1091 rows × 9 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-d16c2384-c3b4-47c0-8cbb-5646d62be869')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-d16c2384-c3b4-47c0-8cbb-5646d62be869 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-d16c2384-c3b4-47c0-8cbb-5646d62be869');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":19}]},{"cell_type":"code","source":["vis_data_records = []\n","vis_data_records_ig = []\n","\n","explain_examples = []\n","i = 0\n","for index, row in data.iterrows():\n","\n","      suceess = row['result_type']\n","\n","      if suceess != \"Successful\":\n","        continue\n","\n","      i = i + 1\n","      print(i)\n","      org_text = row['original_text']\n","      org = row['original_text'].replace(\"[[\", \"\")\n","      org = org.replace(\"]]\", \"\")\n","      #org = str(spell_correct(org))\n","\n","      pert_text = row['perturbed_text']\n","      pert = row['perturbed_text'].replace(\"[[\", \"\")\n","      pert = pert.replace(\"]]\", \"\")\n","      #pert = str(spell_correct(pert))\n","      \n","      attributions_clean_r, tokens_clean_r, true_label_clean_r, pred_clean_r = interpret_sentence(org, true_label=int(row['ground_truth_output']))\n","      attributions_pert_r, tokens_pert_r, true_label_pert_r, pred_pert_r = interpret_sentence(pert, true_label=int(row['ground_truth_output']))\n","\n","      attributions_clean_r, tokens_clean_r = get_cleaned_lists(attributions_clean_r, tokens_clean_r)\n","      attributions_pert_r, tokens_pert_r = get_cleaned_lists(attributions_pert_r, tokens_pert_r)\n","      \n","      explain_examples.append(\n","                {\n","                    \"clean_text\": org_text,\n","                    \"perturbed_text\": pert_text,\n","                    \"clean_text_without_brackets\": org,\n","                    \"perturbed_text_without_brackets\": pert,\n","                    \"clean_text_explainable_scores\": attributions_clean_r,\n","                    \"perturbed_text_explainable_scores\": attributions_pert_r,\n","                    \"clean_tokens\": tokens_clean_r,\n","                    \"pert_tokens\": tokens_pert_r,\n","                    \"clean_label\": row['ground_truth_output'],\n","                    \"perturbed_lable\": row[\"perturbed_output\"],\n","                }\n","\n","            )"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"9jWnW00RSies","outputId":"06a6b4f7-a818-498e-d3a0-6d659059f994"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["1\n"]}]},{"cell_type":"code","source":["import pickle\n","\n","with open('/content/drive/MyDrive/phd/models/imdb/explainability/explainable_imdb_bert_textfool_1.pickle', \"wb\") as handle:\n","    pickle.dump(explain_examples, handle)"],"metadata":{"id":"hOWuuJTltHdR"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["scores = [0.0,\n","  0.04405593067501031,\n","  0.0031569995525052427,\n","  0.0009389861214753062,\n","  0.04630356247730127,\n","  -0.028147343382499763,\n","  0.12071652248054034,\n","  0.9837541787045914,\n","  0.11299190623724431,\n","  0.0]\n","\n","tokens = ['[CLS]',\n","  'the',\n","  'movie',\n","  'was',\n","  'one',\n","  'of',\n","  'those',\n","  'amazing',\n","  'movies',\n","  '[SEP]']"],"metadata":{"id":"LStMZTjucSTM"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["get_cleaned_lists(scores, tokens)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"VAnpnrhvcOHN","executionInfo":{"status":"ok","timestamp":1674306495365,"user_tz":-660,"elapsed":314,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"d408a92b-d2c7-4e61-fe99-32d258714178"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["([0.04405593067501031,\n","  0.0031569995525052427,\n","  0.0009389861214753062,\n","  0.04630356247730127,\n","  -0.028147343382499763,\n","  0.12071652248054034,\n","  0.9837541787045914,\n","  0.11299190623724431],\n"," ['the', 'movie', 'was', 'one', 'of', 'those', 'amazing', 'movies'])"]},"metadata":{},"execution_count":37}]},{"cell_type":"code","metadata":{"id":"T4vlqBBrbUEY","outputId":"15c06385-a82c-455c-d3bc-a9d8aebfc636","executionInfo":{"status":"ok","timestamp":1674303646734,"user_tz":-660,"elapsed":2811,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"colab":{"base_uri":"https://localhost:8080/"}},"source":["# Check predict output\n","predict(input_ids)"],"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["tensor([[-3.2158,  4.0551]], device='cuda:0', grad_fn=<AddmmBackward0>)"]},"metadata":{},"execution_count":15}]},{"cell_type":"code","metadata":{"id":"wpNkwy6_bUEd","outputId":"8189416f-7273-42f4-f2fb-5f4d9372a949","executionInfo":{"status":"ok","timestamp":1674303651293,"user_tz":-660,"elapsed":4,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"colab":{"base_uri":"https://localhost:8080/"}},"source":["# Check output of custom_forward\n","custom_forward(input_ids)"],"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["tensor([0.9993], device='cuda:0', grad_fn=<UnsqueezeBackward0>)"]},"metadata":{},"execution_count":16}]},{"cell_type":"markdown","metadata":{"id":"ItXD4N9FogZu"},"source":["The visualization is clearly meaningless! :(\n"]}]}