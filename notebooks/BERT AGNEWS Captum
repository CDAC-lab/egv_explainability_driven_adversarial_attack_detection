{"nbformat":4,"nbformat_minor":0,"metadata":{"orig_nbformat":2,"file_extension":".py","mimetype":"text/x-python","name":"python","npconvert_exporter":"python","pygments_lexer":"ipython3","version":3,"kernelspec":{"name":"python3","display_name":"Python 3"},"colab":{"provenance":[{"file_id":"1DYolDDidacwtQRrvZJtrUDdNfamFZuWL","timestamp":1674391309715},{"file_id":"1snFbxdVDtL3JEFW7GNfRs1PZKgNHfoNz","timestamp":1674303433353}],"machine_shape":"hm"},"accelerator":"TPU","gpuClass":"standard","widgets":{"application/vnd.jupyter.widget-state+json":{"e2271981a5054f29ab4d11274e89f18b":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_519c8a446e9b4c08bf1195748113a32f","IPY_MODEL_0402d96ced9c4e8dac96f42aec73e23b","IPY_MODEL_c5f8226f8e5e493da0fb10ffe3251fab"],"layout":"IPY_MODEL_8fcc74ecc9e54d849c29422a51442aed"}},"519c8a446e9b4c08bf1195748113a32f":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_3526c5a6c82b4109a6fddb23b0307f78","placeholder":"​","style":"IPY_MODEL_d5e05c13c9614146abd56ad7f2e4d29d","value":"Downloading: 100%"}},"0402d96ced9c4e8dac96f42aec73e23b":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_022e263058c346b5b151109fc7b949d4","max":28,"min":0,"orientation":"horizontal","style":"IPY_MODEL_b8fddda2fc3c46a9a48931e14cfe1747","value":28}},"c5f8226f8e5e493da0fb10ffe3251fab":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_ea70b9c0899f4d1588c439e7e0e72ccb","placeholder":"​","style":"IPY_MODEL_0a7c514e6c8449c2a50eaf4b0bef49b9","value":" 28.0/28.0 [00:00&lt;00:00, 1.67kB/s]"}},"8fcc74ecc9e54d849c29422a51442aed":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"3526c5a6c82b4109a6fddb23b0307f78":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d5e05c13c9614146abd56ad7f2e4d29d":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"022e263058c346b5b151109fc7b949d4":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b8fddda2fc3c46a9a48931e14cfe1747":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"ea70b9c0899f4d1588c439e7e0e72ccb":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0a7c514e6c8449c2a50eaf4b0bef49b9":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"1d3e7aadd429410fa46df1a2e5b3f651":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_05d10a09bfe544a5be17beadafd9407a","IPY_MODEL_ac023cf1117649698ea2753d0e53d45a","IPY_MODEL_e9a9881d603c4dfc8d9d36368e17fc9a"],"layout":"IPY_MODEL_0e33c3c1d202499eb19bfe182081207f"}},"05d10a09bfe544a5be17beadafd9407a":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0ff7d27770204d9d8d6f077231ab70d9","placeholder":"​","style":"IPY_MODEL_1fcbc188fd51487fa31d672eff5aec59","value":"Downloading: 100%"}},"ac023cf1117649698ea2753d0e53d45a":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_97a46c898b29490583a6bdb56380a3d1","max":570,"min":0,"orientation":"horizontal","style":"IPY_MODEL_fdb4b7b396974327a374e330e3dcc311","value":570}},"e9a9881d603c4dfc8d9d36368e17fc9a":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e5c4f5d0e77b4418950b715408100d79","placeholder":"​","style":"IPY_MODEL_2b06030df18545d0923715ba081d0b51","value":" 570/570 [00:00&lt;00:00, 39.5kB/s]"}},"0e33c3c1d202499eb19bfe182081207f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0ff7d27770204d9d8d6f077231ab70d9":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1fcbc188fd51487fa31d672eff5aec59":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"97a46c898b29490583a6bdb56380a3d1":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"fdb4b7b396974327a374e330e3dcc311":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"e5c4f5d0e77b4418950b715408100d79":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"2b06030df18545d0923715ba081d0b51":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"0f701fa55ece4c4abed093dbcac93b22":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_ad47055c446c47a3b56a848964137d57","IPY_MODEL_8b293284439e4ce09013ec0da870b5b2","IPY_MODEL_523358c0271d4be89f21bb9ac284c39c"],"layout":"IPY_MODEL_900ba880d69247d3819b33b2518d38dd"}},"ad47055c446c47a3b56a848964137d57":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_9de1a30bcea841b0987b4714d04b385a","placeholder":"​","style":"IPY_MODEL_67d964ef248b4c6280781c16775d954b","value":"Downloading: 100%"}},"8b293284439e4ce09013ec0da870b5b2":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_e4ede35967c24d99bd18c26433cafb4e","max":231508,"min":0,"orientation":"horizontal","style":"IPY_MODEL_1065f8bbc0174e4d83ae7bf12fb91876","value":231508}},"523358c0271d4be89f21bb9ac284c39c":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_c77b81de41f04bceb37debf20ce6e33d","placeholder":"​","style":"IPY_MODEL_5398be1b9dbd4bf3a0507fe45e358e22","value":" 232k/232k [00:00&lt;00:00, 1.78MB/s]"}},"900ba880d69247d3819b33b2518d38dd":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9de1a30bcea841b0987b4714d04b385a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"67d964ef248b4c6280781c16775d954b":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"e4ede35967c24d99bd18c26433cafb4e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1065f8bbc0174e4d83ae7bf12fb91876":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"c77b81de41f04bceb37debf20ce6e33d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"5398be1b9dbd4bf3a0507fe45e358e22":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"3da7495e7b2e4dfb86a4cced99613d87":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_524a732b3daf4a798690cc5b0b442f2f","IPY_MODEL_912d6bea1c5548d6ada01644d54220f5","IPY_MODEL_27f4576010c843d8ae55585c14abcdfb"],"layout":"IPY_MODEL_5771ef124b4b431c9f554c9ebd51d680"}},"524a732b3daf4a798690cc5b0b442f2f":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_44d6af0ff5874f0db5e452658ba465bc","placeholder":"​","style":"IPY_MODEL_6d45c256b53a4c91897d1e1d1ffd4509","value":"Downloading: 100%"}},"912d6bea1c5548d6ada01644d54220f5":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_16a8e750067049ccadefdfe873a20486","max":466062,"min":0,"orientation":"horizontal","style":"IPY_MODEL_696ddac4884a4dbc97ec33bdae6474c8","value":466062}},"27f4576010c843d8ae55585c14abcdfb":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_3cc45a8a5c3e445197a55ed60fad8cb5","placeholder":"​","style":"IPY_MODEL_23f2f1c24e2e4b88834efebb5bd9a2c1","value":" 466k/466k [00:00&lt;00:00, 1.76MB/s]"}},"5771ef124b4b431c9f554c9ebd51d680":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"44d6af0ff5874f0db5e452658ba465bc":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6d45c256b53a4c91897d1e1d1ffd4509":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"16a8e750067049ccadefdfe873a20486":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"696ddac4884a4dbc97ec33bdae6474c8":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"3cc45a8a5c3e445197a55ed60fad8cb5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"23f2f1c24e2e4b88834efebb5bd9a2c1":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"markdown","metadata":{"id":"UFESEuEgbUDD"},"source":["# Interpretation of BertForSequenceClassification in captum\n","\n","In this notebook we use Captum to interpret a BERT sentiment classifier finetuned on the imdb dataset https://huggingface.co/lvwerra/bert-imdb "]},{"cell_type":"code","metadata":{"id":"EJ51JAxHbghp","colab":{"base_uri":"https://localhost:8080/"},"outputId":"e21ac69c-b6e1-483a-bd8c-b941a94cffd7","executionInfo":{"status":"ok","timestamp":1674541189525,"user_tz":-660,"elapsed":14305,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["# Install dependencies\n","!pip install transformers\n","!pip install captum"],"execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting transformers\n","  Downloading transformers-4.25.1-py3-none-any.whl (5.8 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m5.8/5.8 MB\u001b[0m \u001b[31m50.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: filelock in /usr/local/lib/python3.8/dist-packages (from transformers) (3.9.0)\n","Requirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.8/dist-packages (from transformers) (1.21.6)\n","Requirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.8/dist-packages (from transformers) (21.3)\n","Collecting huggingface-hub<1.0,>=0.10.0\n","  Downloading huggingface_hub-0.11.1-py3-none-any.whl (182 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m182.4/182.4 KB\u001b[0m \u001b[31m12.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting tokenizers!=0.11.3,<0.14,>=0.11.1\n","  Downloading tokenizers-0.13.2-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (7.6 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m7.6/7.6 MB\u001b[0m \u001b[31m89.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: requests in /usr/local/lib/python3.8/dist-packages (from transformers) (2.25.1)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.8/dist-packages (from transformers) (2022.6.2)\n","Requirement already satisfied: pyyaml>=5.1 in /usr/local/lib/python3.8/dist-packages (from transformers) (6.0)\n","Requirement already satisfied: tqdm>=4.27 in /usr/local/lib/python3.8/dist-packages (from transformers) (4.64.1)\n","Requirement already satisfied: typing-extensions>=3.7.4.3 in /usr/local/lib/python3.8/dist-packages (from huggingface-hub<1.0,>=0.10.0->transformers) (4.4.0)\n","Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /usr/local/lib/python3.8/dist-packages (from packaging>=20.0->transformers) (3.0.9)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.8/dist-packages (from requests->transformers) (2.10)\n","Requirement already satisfied: chardet<5,>=3.0.2 in /usr/local/lib/python3.8/dist-packages (from requests->transformers) (4.0.0)\n","Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.8/dist-packages (from requests->transformers) (1.24.3)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.8/dist-packages (from requests->transformers) (2022.12.7)\n","Installing collected packages: tokenizers, huggingface-hub, transformers\n","Successfully installed huggingface-hub-0.11.1 tokenizers-0.13.2 transformers-4.25.1\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting captum\n","  Downloading captum-0.6.0-py3-none-any.whl (1.3 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m1.3/1.3 MB\u001b[0m \u001b[31m19.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: matplotlib in /usr/local/lib/python3.8/dist-packages (from captum) (3.2.2)\n","Requirement already satisfied: torch>=1.6 in /usr/local/lib/python3.8/dist-packages (from captum) (1.13.1+cu116)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.8/dist-packages (from captum) (1.21.6)\n","Requirement already satisfied: typing-extensions in /usr/local/lib/python3.8/dist-packages (from torch>=1.6->captum) (4.4.0)\n","Requirement already satisfied: python-dateutil>=2.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->captum) (2.8.2)\n","Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->captum) (3.0.9)\n","Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->captum) (1.4.4)\n","Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.8/dist-packages (from matplotlib->captum) (0.11.0)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.8/dist-packages (from python-dateutil>=2.1->matplotlib->captum) (1.15.0)\n","Installing collected packages: captum\n","Successfully installed captum-0.6.0\n"]}]},{"cell_type":"code","source":["from google.colab import drive\n","drive.mount('/content/drive')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"hmg7Pem6Q6ON","executionInfo":{"status":"ok","timestamp":1674541210714,"user_tz":-660,"elapsed":21199,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"42e25ed7-7cb5-4c0f-a325-891fe9ede210"},"execution_count":2,"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}]},{"cell_type":"code","metadata":{"id":"CS9Kaz8ubUDG","executionInfo":{"status":"ok","timestamp":1674541217055,"user_tz":-660,"elapsed":6352,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["from transformers import BertTokenizer, BertForSequenceClassification, BertConfig\n","from captum.attr import visualization as viz\n","from captum.attr import IntegratedGradients, LayerConductance, LayerIntegratedGradients\n","from captum.attr import configure_interpretable_embedding_layer, remove_interpretable_embedding_layer\n","import torch\n","import matplotlib.pyplot as plt"],"execution_count":3,"outputs":[]},{"cell_type":"code","metadata":{"id":"P1yl1gdvbUDS","executionInfo":{"status":"ok","timestamp":1674541217056,"user_tz":-660,"elapsed":44,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["device = torch.device(\"cuda:0\" if torch.cuda.is_available() else \"cpu\")"],"execution_count":4,"outputs":[]},{"cell_type":"code","source":["device"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"PN68aIbKr173","executionInfo":{"status":"ok","timestamp":1674541217057,"user_tz":-660,"elapsed":42,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"7b6985b1-84a1-43d2-b735-9dc13496867a"},"execution_count":5,"outputs":[{"output_type":"execute_result","data":{"text/plain":["device(type='cpu')"]},"metadata":{},"execution_count":5}]},{"cell_type":"code","source":["from transformers import AutoTokenizer, AutoModelForSequenceClassification\n","tokenizer = AutoTokenizer.from_pretrained(\"bert-base-uncased\")\n","path = '/content/drive/MyDrive/phd/models/imdb/language_models/bert-agnews-finetune'\n","model = AutoModelForSequenceClassification.from_pretrained(path)\n","model.to(device)\n","model.eval()\n","model.zero_grad()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":145,"referenced_widgets":["e2271981a5054f29ab4d11274e89f18b","519c8a446e9b4c08bf1195748113a32f","0402d96ced9c4e8dac96f42aec73e23b","c5f8226f8e5e493da0fb10ffe3251fab","8fcc74ecc9e54d849c29422a51442aed","3526c5a6c82b4109a6fddb23b0307f78","d5e05c13c9614146abd56ad7f2e4d29d","022e263058c346b5b151109fc7b949d4","b8fddda2fc3c46a9a48931e14cfe1747","ea70b9c0899f4d1588c439e7e0e72ccb","0a7c514e6c8449c2a50eaf4b0bef49b9","1d3e7aadd429410fa46df1a2e5b3f651","05d10a09bfe544a5be17beadafd9407a","ac023cf1117649698ea2753d0e53d45a","e9a9881d603c4dfc8d9d36368e17fc9a","0e33c3c1d202499eb19bfe182081207f","0ff7d27770204d9d8d6f077231ab70d9","1fcbc188fd51487fa31d672eff5aec59","97a46c898b29490583a6bdb56380a3d1","fdb4b7b396974327a374e330e3dcc311","e5c4f5d0e77b4418950b715408100d79","2b06030df18545d0923715ba081d0b51","0f701fa55ece4c4abed093dbcac93b22","ad47055c446c47a3b56a848964137d57","8b293284439e4ce09013ec0da870b5b2","523358c0271d4be89f21bb9ac284c39c","900ba880d69247d3819b33b2518d38dd","9de1a30bcea841b0987b4714d04b385a","67d964ef248b4c6280781c16775d954b","e4ede35967c24d99bd18c26433cafb4e","1065f8bbc0174e4d83ae7bf12fb91876","c77b81de41f04bceb37debf20ce6e33d","5398be1b9dbd4bf3a0507fe45e358e22","3da7495e7b2e4dfb86a4cced99613d87","524a732b3daf4a798690cc5b0b442f2f","912d6bea1c5548d6ada01644d54220f5","27f4576010c843d8ae55585c14abcdfb","5771ef124b4b431c9f554c9ebd51d680","44d6af0ff5874f0db5e452658ba465bc","6d45c256b53a4c91897d1e1d1ffd4509","16a8e750067049ccadefdfe873a20486","696ddac4884a4dbc97ec33bdae6474c8","3cc45a8a5c3e445197a55ed60fad8cb5","23f2f1c24e2e4b88834efebb5bd9a2c1"]},"id":"eN7Lqzb8RHy7","executionInfo":{"status":"ok","timestamp":1674541223739,"user_tz":-660,"elapsed":6717,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"87684464-7c61-4fc8-eb4b-d9677f95db72"},"execution_count":6,"outputs":[{"output_type":"display_data","data":{"text/plain":["Downloading:   0%|          | 0.00/28.0 [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"e2271981a5054f29ab4d11274e89f18b"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading:   0%|          | 0.00/570 [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"1d3e7aadd429410fa46df1a2e5b3f651"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading:   0%|          | 0.00/232k [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"0f701fa55ece4c4abed093dbcac93b22"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading:   0%|          | 0.00/466k [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"3da7495e7b2e4dfb86a4cced99613d87"}},"metadata":{}}]},{"cell_type":"code","metadata":{"id":"JUMsvUOTbUDi","executionInfo":{"status":"ok","timestamp":1674541223740,"user_tz":-660,"elapsed":47,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["def predict(inputs):\n","    return model(inputs)[0]"],"execution_count":7,"outputs":[]},{"cell_type":"code","metadata":{"id":"SIbauwGbbUDo","executionInfo":{"status":"ok","timestamp":1674541223741,"user_tz":-660,"elapsed":46,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["ref_token_id = tokenizer.pad_token_id # A token used for generating token reference\n","sep_token_id = tokenizer.sep_token_id # A token used as a separator between question and text and it is also added to the end of the text.\n","cls_token_id = tokenizer.cls_token_id # A token used for prepending to the concatenated question-text word sequence"],"execution_count":8,"outputs":[]},{"cell_type":"code","metadata":{"id":"mcnTCNUFbUD1","executionInfo":{"status":"ok","timestamp":1674541223741,"user_tz":-660,"elapsed":45,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["def construct_input_ref_pair(text, ref_token_id, sep_token_id, cls_token_id):\n","\n","    text_ids = tokenizer.encode(text, add_special_tokens=False)\n","    # construct input token ids\n","    input_ids = [cls_token_id] + text_ids + [sep_token_id]\n","    # construct reference token ids \n","    ref_input_ids = [cls_token_id] + [ref_token_id] * len(text_ids) + [sep_token_id]\n","\n","    return torch.tensor([input_ids], device=device), torch.tensor([ref_input_ids], device=device), len(text_ids)\n","\n","def construct_input_ref_token_type_pair(input_ids, sep_ind=0):\n","    seq_len = input_ids.size(1)\n","    token_type_ids = torch.tensor([[0 if i <= sep_ind else 1 for i in range(seq_len)]], device=device)\n","    ref_token_type_ids = torch.zeros_like(token_type_ids, device=device)# * -1\n","    return token_type_ids, ref_token_type_ids\n","\n","def construct_input_ref_pos_id_pair(input_ids):\n","    seq_length = input_ids.size(1)\n","    position_ids = torch.arange(seq_length, dtype=torch.long, device=device)\n","    # we could potentially also use random permutation with `torch.randperm(seq_length, device=device)`\n","    ref_position_ids = torch.zeros(seq_length, dtype=torch.long, device=device)\n","\n","    position_ids = position_ids.unsqueeze(0).expand_as(input_ids)\n","    ref_position_ids = ref_position_ids.unsqueeze(0).expand_as(input_ids)\n","    return position_ids, ref_position_ids\n","    \n","def construct_attention_mask(input_ids):\n","    return torch.ones_like(input_ids)"],"execution_count":9,"outputs":[]},{"cell_type":"code","metadata":{"id":"vhasPia4bUD8","executionInfo":{"status":"ok","timestamp":1674541223742,"user_tz":-660,"elapsed":46,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["def custom_forward(inputs):\n","    preds = predict(inputs)\n","    return torch.softmax(preds, dim = 1)[0][1].unsqueeze(-1)"],"execution_count":10,"outputs":[]},{"cell_type":"code","metadata":{"id":"pGwkb1vAbUEA","executionInfo":{"status":"ok","timestamp":1674541223743,"user_tz":-660,"elapsed":46,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["lig = LayerIntegratedGradients(predict, model.bert.embeddings)"],"execution_count":11,"outputs":[]},{"cell_type":"code","source":["def interpret_sentence(text, true_label):\n","  input_ids, ref_input_ids, sep_id = construct_input_ref_pair(text, ref_token_id, sep_token_id, cls_token_id)\n","  token_type_ids, ref_token_type_ids = construct_input_ref_token_type_pair(input_ids, sep_id)\n","  position_ids, ref_position_ids = construct_input_ref_pos_id_pair(input_ids)\n","  attention_mask = construct_attention_mask(input_ids)\n","  indices = input_ids[0].detach().tolist()\n","  converted_tokens = tokenizer.convert_ids_to_tokens(indices)\n","  all_tokens = tokenizer.convert_ids_to_tokens(indices)\n","  attributions, delta = lig.attribute(inputs=input_ids,\n","                                    baselines=ref_input_ids,\n","                                    n_steps=250,\n","                                    return_convergence_delta=True, target=true_label)\n","  attributions = attributions.sum(dim=-1).squeeze(0)\n","  attributions = attributions / torch.norm(attributions)\n","  attributions = attributions.detach().tolist()\n","  return attributions, converted_tokens, true_label, true_label "],"metadata":{"id":"kcPkPizySztc","executionInfo":{"status":"ok","timestamp":1674541224206,"user_tz":-660,"elapsed":23,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"execution_count":12,"outputs":[]},{"cell_type":"code","source":["from textblob import TextBlob\n","\n","def spell_correct(input):\n","  str_input = TextBlob(input)\n","  return str_input.correct()"],"metadata":{"id":"8-x7tCOPPZFo","executionInfo":{"status":"ok","timestamp":1674541225655,"user_tz":-660,"elapsed":1470,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"execution_count":13,"outputs":[]},{"cell_type":"code","source":["def get_cleaned_lists(word_attributions, tokens):\n","  tokens_list = [] \n","  att_list = []\n","  index = 0\n","  for word, score in zip(tokens, word_attributions):\n","    if word == '[CLS]' or word == '[SEP]':\n","      continue\n","    tokens_list.append(word)\n","    att_list.append(score)\n","\n","  clean_token_list = []\n","  clean_att_list = []\n","  index = 0\n","\n","  while index < len(tokens_list):\n","    word = tokens_list[index]\n","    score = att_list[index]\n","    sub_word_list = []\n","    sub_score_list = []\n","    sub_word_list.append(word)\n","    sub_score_list.append(score)\n","    index = index + 1\n","    if index < (len(tokens_list) - 1):\n","      next_word = tokens_list[index]\n","      next_score = att_list[index]\n","      while next_word.startswith('##') and index < (len(tokens_list) - 1):\n","        sub_word_list.append(next_word.replace('##', ''))\n","        sub_score_list.append(next_score)\n","        index = index + 1\n","        next_word = tokens_list[index]\n","        next_score = att_list[index]\n","  \n","    clean_token_list.append(''.join(sub_word_list))\n","    clean_att_list.append(max(sub_score_list, key=abs))\n","  return clean_att_list, clean_token_list"],"metadata":{"id":"F-wQuOn9YFAl","executionInfo":{"status":"ok","timestamp":1674541225657,"user_tz":-660,"elapsed":11,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"execution_count":14,"outputs":[]},{"cell_type":"code","metadata":{"id":"EQlVDaISbUEF","executionInfo":{"status":"ok","timestamp":1674541232016,"user_tz":-660,"elapsed":362,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"source":["# One can test a couple of examples and check that the sentiment classifier is behaving\n","#text = \"The movie was one of those amazing movies\"\n","#text = \"The movie was one of those crappy movies you can't forget.\"\n","text =\"The Race is On: Second Private Team Sets Launch Date for Human Spaceflight (SPACE.com) SPACE.com - TORONTO, Canada -- A second\\team of rocketeers competing for the #36;10 million Ansari X Prize, a contest for\\privately funded suborbital space flight, has officially announced the first\\launch date for its manned rocket.\"\n"],"execution_count":16,"outputs":[]},{"cell_type":"code","source":["interpret_sentence(text, 3)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"NSAyGeQzVuzd","executionInfo":{"status":"ok","timestamp":1674481537031,"user_tz":-660,"elapsed":9878,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"c710fe19-796e-4309-8c49-d9965a51c690"},"execution_count":18,"outputs":[{"output_type":"execute_result","data":{"text/plain":["([0.0,\n","  0.12060952753424964,\n","  0.29305349207106557,\n","  0.05606095352731761,\n","  0.019574667900092338,\n","  0.040144855070112555,\n","  -0.051151080136894934,\n","  0.034949259474923965,\n","  0.16405031772824727,\n","  -0.030352774517483427,\n","  0.0015167972869471397,\n","  0.09450396114589824,\n","  0.016032696359430006,\n","  0.30759347430365913,\n","  0.2970519042818812,\n","  0.31131789973172924,\n","  0.1405117853202574,\n","  0.17850880933020385,\n","  0.05677350177695788,\n","  0.04163150132857123,\n","  0.11401895548220659,\n","  0.3185921789130168,\n","  -0.017428932099787305,\n","  0.07582447509431563,\n","  0.11250732169557495,\n","  0.0623729532000578,\n","  -0.04305325465540119,\n","  0.11312612877452424,\n","  -0.35225812951297,\n","  0.08517295303997575,\n","  -0.01268867530104605,\n","  0.0031123842960260268,\n","  -0.027036567274812552,\n","  0.012935389325326585,\n","  0.06420912639012726,\n","  0.15437257646033428,\n","  0.09029594472084251,\n","  0.04974116833849609,\n","  0.10093427657512069,\n","  0.3075439546167168,\n","  0.040888009984897195,\n","  0.03682294013760662,\n","  0.011015386884873666,\n","  0.009405425015108314,\n","  0.022762309215817594,\n","  0.016071459496123316,\n","  -0.017454180334663533,\n","  0.02548644943771987,\n","  0.029088619078689263,\n","  0.005463499975687678,\n","  -0.02400123275374018,\n","  -0.002824876761088772,\n","  0.0028628559457397206,\n","  0.027177871050649265,\n","  -0.009681094250546361,\n","  0.03640876693805271,\n","  -0.014975206550723614,\n","  -0.010864468199683026,\n","  -0.04009551883102754,\n","  0.011013458339292348,\n","  0.11564184343836027,\n","  0.10282225606718713,\n","  0.003152789686557399,\n","  -0.01588469061037115,\n","  -0.025375947387841886,\n","  -0.0016162635684398604,\n","  0.07785033130669203,\n","  0.016804425760095037,\n","  -0.06704892038551116,\n","  0.0005097784405796707,\n","  -0.00510156987994643,\n","  -0.04909194815022684,\n","  -0.06167431472253533,\n","  0.005049058982743004,\n","  0.1857823207473318,\n","  -0.05080561543318332,\n","  0.0],\n"," ['[CLS]',\n","  'the',\n","  'race',\n","  'is',\n","  'on',\n","  ':',\n","  'second',\n","  'private',\n","  'team',\n","  'sets',\n","  'launch',\n","  'date',\n","  'for',\n","  'human',\n","  'space',\n","  '##flight',\n","  '(',\n","  'space',\n","  '.',\n","  'com',\n","  ')',\n","  'space',\n","  '.',\n","  'com',\n","  '-',\n","  'toronto',\n","  ',',\n","  'canada',\n","  '-',\n","  '-',\n","  'a',\n","  'second',\n","  'ea',\n","  '##m',\n","  'of',\n","  'rocket',\n","  '##eers',\n","  'competing',\n","  'for',\n","  'the',\n","  '#',\n","  '36',\n","  ';',\n","  '10',\n","  'million',\n","  'an',\n","  '##sari',\n","  'x',\n","  'prize',\n","  ',',\n","  'a',\n","  'contest',\n","  'for',\n","  '\\\\',\n","  'privately',\n","  'funded',\n","  'sub',\n","  '##or',\n","  '##bit',\n","  '##al',\n","  'space',\n","  'flight',\n","  ',',\n","  'has',\n","  'officially',\n","  'announced',\n","  'the',\n","  'first',\n","  '\\\\',\n","  'launch',\n","  'date',\n","  'for',\n","  'its',\n","  'manned',\n","  'rocket',\n","  '.',\n","  '[SEP]'],\n"," 3,\n"," 3)"]},"metadata":{},"execution_count":18}]},{"cell_type":"code","source":["interpret_sentence(text, 0)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"NYZK_AVhW3EL","executionInfo":{"status":"ok","timestamp":1674541244897,"user_tz":-660,"elapsed":9769,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"e54f35e9-f4b2-4013-9fc0-6cea63cfd2c4"},"execution_count":17,"outputs":[{"output_type":"execute_result","data":{"text/plain":["([0.0,\n","  0.06310472688294796,\n","  0.17591205619931105,\n","  0.053124791063059465,\n","  -0.06225957175060697,\n","  -0.12576212965762545,\n","  -0.055807658436932035,\n","  0.012245557750165623,\n","  0.048209567032843584,\n","  0.013886914498552828,\n","  -0.05128926730241812,\n","  0.023540125531609387,\n","  -0.03855057069062651,\n","  0.04407174082807632,\n","  -0.08898047747165433,\n","  -0.027144875443994583,\n","  0.04268908329296372,\n","  0.018674218921533675,\n","  -0.06594797183950854,\n","  -0.020165599740603505,\n","  0.01616513216796227,\n","  0.021661432046404007,\n","  -0.18832240311581933,\n","  0.11289178985091074,\n","  -0.19071550554976927,\n","  -0.09839306429411598,\n","  -0.10348899117354245,\n","  0.05911186649359783,\n","  -0.8162144293696779,\n","  0.12220703360217555,\n","  0.04115571492426051,\n","  -0.00815450730623139,\n","  -0.02480027871326763,\n","  -0.03080347656187765,\n","  -0.0351287897193368,\n","  0.030329942909289836,\n","  -0.004123166087040814,\n","  0.007806480007270845,\n","  0.016245917139228978,\n","  0.07352795681707382,\n","  -0.009803106944226219,\n","  -0.04907622334602829,\n","  -0.09341431885824825,\n","  0.029588310269815718,\n","  -0.0085158490726207,\n","  0.03499740145964403,\n","  0.015277249289241363,\n","  0.000653654273816096,\n","  0.04386097002526068,\n","  -0.0316042441015258,\n","  -0.019045844807839687,\n","  0.0034683705658397693,\n","  -0.0030070109380654236,\n","  0.1311467801345904,\n","  0.00984948936771081,\n","  -0.007665199652488664,\n","  -0.012252734224189552,\n","  -0.002690680603076621,\n","  0.025862395803147406,\n","  -0.0033310319843822414,\n","  -0.05940552485079333,\n","  -0.040404666188417426,\n","  -0.028101786844765855,\n","  -0.043205584763400806,\n","  -0.00026024571836973293,\n","  -0.058290486409521676,\n","  0.03883443347055485,\n","  -0.05405311668243978,\n","  0.20724759145551575,\n","  -0.03949414587607339,\n","  0.017164211365180038,\n","  -0.030515037238476022,\n","  -0.03608013886036442,\n","  -0.005132088247609662,\n","  -0.02078354355518462,\n","  0.12139932763651881,\n","  0.0],\n"," ['[CLS]',\n","  'the',\n","  'race',\n","  'is',\n","  'on',\n","  ':',\n","  'second',\n","  'private',\n","  'team',\n","  'sets',\n","  'launch',\n","  'date',\n","  'for',\n","  'human',\n","  'space',\n","  '##flight',\n","  '(',\n","  'space',\n","  '.',\n","  'com',\n","  ')',\n","  'space',\n","  '.',\n","  'com',\n","  '-',\n","  'toronto',\n","  ',',\n","  'canada',\n","  '-',\n","  '-',\n","  'a',\n","  'second',\n","  'ea',\n","  '##m',\n","  'of',\n","  'rocket',\n","  '##eers',\n","  'competing',\n","  'for',\n","  'the',\n","  '#',\n","  '36',\n","  ';',\n","  '10',\n","  'million',\n","  'an',\n","  '##sari',\n","  'x',\n","  'prize',\n","  ',',\n","  'a',\n","  'contest',\n","  'for',\n","  '\\\\',\n","  'privately',\n","  'funded',\n","  'sub',\n","  '##or',\n","  '##bit',\n","  '##al',\n","  'space',\n","  'flight',\n","  ',',\n","  'has',\n","  'officially',\n","  'announced',\n","  'the',\n","  'first',\n","  '\\\\',\n","  'launch',\n","  'date',\n","  'for',\n","  'its',\n","  'manned',\n","  'rocket',\n","  '.',\n","  '[SEP]'],\n"," 0,\n"," 0)"]},"metadata":{},"execution_count":17}]},{"cell_type":"code","source":["import pandas as pd\n","import re\n","# data1 = pd.read_csv(\"/content/drive/MyDrive/phd/models/imdb/bert_imdb_attack_bae.csv\")\n","# data2 = pd.read_csv(\"/content/drive/MyDrive/phd/models/imdb/bert_imdb_attack_bae_1.csv\")\n","# data3 = pd.read_csv(\"/content/drive/MyDrive/phd/models/imdb/bert_imdb_attack_bae_2.csv\")\n","\n","data = pd.read_csv(\"/content/drive/MyDrive/phd/models/agnews/bert_agnews_attack_deepwordbug.csv\")"],"metadata":{"id":"mBUsIi2Af7Ww","executionInfo":{"status":"ok","timestamp":1674543634425,"user_tz":-660,"elapsed":308,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"execution_count":23,"outputs":[]},{"cell_type":"code","source":["data"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"id":"7tKyl5unPr-N","executionInfo":{"status":"ok","timestamp":1674543636358,"user_tz":-660,"elapsed":458,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"ae055a09-01f1-45a7-a20f-56b2e88f6cc2"},"execution_count":24,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                                          original_text  \\\n","0     [[Lazard]] [[adversaries]] edge closer to a de...   \n","1     European [[spacecraft]] prepares to [[orbit]] ...   \n","2     [[Fed]] lifts rates a further [[quarter]] poin...   \n","3     Pepperdine [[80]], Fairleigh [[Dickinson]] [[7...   \n","4     Indian-Americans hail Manmohan speech New York...   \n","...                                                 ...   \n","1231  [[Thailand]] Tackles [[Bird]] Flu Epidemic BAN...   \n","1232  Zurich Employees [[Plead]] Guilty in Probe  NE...   \n","1233  GM Plans to Use Woods More Creatively ([[AP]])...   \n","1234  [[US]] [[ends]] Jamaica #39;s [[Cup]] [[hopes]...   \n","1235  [[Gregg]]: I will help to [[close]] [[deal]] [...   \n","\n","                                         perturbed_text  original_score  \\\n","0     [[Laard]] [[adversries]] edge closer to a deal...        0.002362   \n","1     European [[spaccraft]] prepares to [[orbiut]] ...        0.007563   \n","2     [[Fe]] lifts rates a further [[pquarter]] poin...        0.000745   \n","3     Pepperdine [[0]], Fairleigh [[Dickinsox]] [[h9...        0.000183   \n","4     Indian-Americans hail Manmohan speech New York...        0.026714   \n","...                                                 ...             ...   \n","1231  [[TYhailand]] Tackles [[Brd]] Flu Epidemic BAN...        0.001641   \n","1232  Zurich Employees [[lead]] Guilty in Probe  NEW...        0.000463   \n","1233  GM Plans to Use Woods More Creatively ([[uP]])...        0.000455   \n","1234  [[SU]] [[eVds]] Jamaica #39;s [[hup]] [[hHopes...        0.000183   \n","1235  [[Gergg]]: I will help to [[lcose]] [[detl]] [...        0.000189   \n","\n","      perturbed_score  original_output  perturbed_output  ground_truth_output  \\\n","0            0.855497                2                 1                    2   \n","1            0.210862                3                 3                    3   \n","2            0.967426                2                 3                    2   \n","3            0.982139                1                 2                    1   \n","4            0.797985                0                 2                    0   \n","...               ...              ...               ...                  ...   \n","1231         0.886291                0                 3                    0   \n","1232         0.000499                2                 2                    2   \n","1233         0.999745                1                 2                    1   \n","1234         0.003669                1                 1                    1   \n","1235         0.794408                1                 0                    1   \n","\n","      num_queries result_type  \n","0              28  Successful  \n","1             124      Failed  \n","2              73  Successful  \n","3             119  Successful  \n","4              38  Successful  \n","...           ...         ...  \n","1231           73  Successful  \n","1232          120      Failed  \n","1233           49  Successful  \n","1234          141      Failed  \n","1235           47  Successful  \n","\n","[1236 rows x 9 columns]"],"text/html":["\n","  <div id=\"df-4b605919-74d7-4b66-92ea-3884e7e22c6c\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>original_text</th>\n","      <th>perturbed_text</th>\n","      <th>original_score</th>\n","      <th>perturbed_score</th>\n","      <th>original_output</th>\n","      <th>perturbed_output</th>\n","      <th>ground_truth_output</th>\n","      <th>num_queries</th>\n","      <th>result_type</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>[[Lazard]] [[adversaries]] edge closer to a de...</td>\n","      <td>[[Laard]] [[adversries]] edge closer to a deal...</td>\n","      <td>0.002362</td>\n","      <td>0.855497</td>\n","      <td>2</td>\n","      <td>1</td>\n","      <td>2</td>\n","      <td>28</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>European [[spacecraft]] prepares to [[orbit]] ...</td>\n","      <td>European [[spaccraft]] prepares to [[orbiut]] ...</td>\n","      <td>0.007563</td>\n","      <td>0.210862</td>\n","      <td>3</td>\n","      <td>3</td>\n","      <td>3</td>\n","      <td>124</td>\n","      <td>Failed</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>[[Fed]] lifts rates a further [[quarter]] poin...</td>\n","      <td>[[Fe]] lifts rates a further [[pquarter]] poin...</td>\n","      <td>0.000745</td>\n","      <td>0.967426</td>\n","      <td>2</td>\n","      <td>3</td>\n","      <td>2</td>\n","      <td>73</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>Pepperdine [[80]], Fairleigh [[Dickinson]] [[7...</td>\n","      <td>Pepperdine [[0]], Fairleigh [[Dickinsox]] [[h9...</td>\n","      <td>0.000183</td>\n","      <td>0.982139</td>\n","      <td>1</td>\n","      <td>2</td>\n","      <td>1</td>\n","      <td>119</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>Indian-Americans hail Manmohan speech New York...</td>\n","      <td>Indian-Americans hail Manmohan speech New York...</td>\n","      <td>0.026714</td>\n","      <td>0.797985</td>\n","      <td>0</td>\n","      <td>2</td>\n","      <td>0</td>\n","      <td>38</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>1231</th>\n","      <td>[[Thailand]] Tackles [[Bird]] Flu Epidemic BAN...</td>\n","      <td>[[TYhailand]] Tackles [[Brd]] Flu Epidemic BAN...</td>\n","      <td>0.001641</td>\n","      <td>0.886291</td>\n","      <td>0</td>\n","      <td>3</td>\n","      <td>0</td>\n","      <td>73</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>1232</th>\n","      <td>Zurich Employees [[Plead]] Guilty in Probe  NE...</td>\n","      <td>Zurich Employees [[lead]] Guilty in Probe  NEW...</td>\n","      <td>0.000463</td>\n","      <td>0.000499</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>120</td>\n","      <td>Failed</td>\n","    </tr>\n","    <tr>\n","      <th>1233</th>\n","      <td>GM Plans to Use Woods More Creatively ([[AP]])...</td>\n","      <td>GM Plans to Use Woods More Creatively ([[uP]])...</td>\n","      <td>0.000455</td>\n","      <td>0.999745</td>\n","      <td>1</td>\n","      <td>2</td>\n","      <td>1</td>\n","      <td>49</td>\n","      <td>Successful</td>\n","    </tr>\n","    <tr>\n","      <th>1234</th>\n","      <td>[[US]] [[ends]] Jamaica #39;s [[Cup]] [[hopes]...</td>\n","      <td>[[SU]] [[eVds]] Jamaica #39;s [[hup]] [[hHopes...</td>\n","      <td>0.000183</td>\n","      <td>0.003669</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>141</td>\n","      <td>Failed</td>\n","    </tr>\n","    <tr>\n","      <th>1235</th>\n","      <td>[[Gregg]]: I will help to [[close]] [[deal]] [...</td>\n","      <td>[[Gergg]]: I will help to [[lcose]] [[detl]] [...</td>\n","      <td>0.000189</td>\n","      <td>0.794408</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>47</td>\n","      <td>Successful</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>1236 rows × 9 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-4b605919-74d7-4b66-92ea-3884e7e22c6c')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-4b605919-74d7-4b66-92ea-3884e7e22c6c button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-4b605919-74d7-4b66-92ea-3884e7e22c6c');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":24}]},{"cell_type":"code","source":["vis_data_records = []\n","vis_data_records_ig = []\n","\n","explain_examples = []\n","i = 0\n","for index, row in data.iterrows():\n","\n","      suceess = row['result_type']\n","\n","      if suceess != \"Successful\":\n","        continue\n","\n","      i = i + 1\n","      print(i)\n","      org_text = row['original_text']\n","      org = row['original_text'].replace(\"[[\", \"\")\n","      org = org.replace(\"]]\", \"\")\n","      org = str(spell_correct(org))\n","\n","      pert_text = row['perturbed_text']\n","      pert = row['perturbed_text'].replace(\"[[\", \"\")\n","      pert = pert.replace(\"]]\", \"\")\n","      pert = str(spell_correct(pert))\n","      \n","      attributions_clean_r, tokens_clean_r, true_label_clean_r, pred_clean_r = interpret_sentence(org, true_label=int(row['ground_truth_output']))\n","      attributions_pert_r, tokens_pert_r, true_label_pert_r, pred_pert_r = interpret_sentence(pert, true_label=int(row['ground_truth_output']))\n","\n","      attributions_clean_r, tokens_clean_r = get_cleaned_lists(attributions_clean_r, tokens_clean_r)\n","      attributions_pert_r, tokens_pert_r = get_cleaned_lists(attributions_pert_r, tokens_pert_r)\n","      \n","      explain_examples.append(\n","                {\n","                    \"clean_text\": org_text,\n","                    \"perturbed_text\": pert_text,\n","                    \"clean_text_without_brackets\": org,\n","                    \"perturbed_text_without_brackets\": pert,\n","                    \"clean_text_explainable_scores\": attributions_clean_r,\n","                    \"perturbed_text_explainable_scores\": attributions_pert_r,\n","                    \"clean_tokens\": tokens_clean_r,\n","                    \"pert_tokens\": tokens_pert_r,\n","                    \"clean_label\": row['ground_truth_output'],\n","                    \"perturbed_lable\": row[\"perturbed_output\"],\n","                }\n","\n","            )"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"9jWnW00RSies","outputId":"f21903a8-afe3-405b-97af-5d259e5c90c2","executionInfo":{"status":"ok","timestamp":1674555299612,"user_tz":-660,"elapsed":11657769,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"execution_count":25,"outputs":[{"output_type":"stream","name":"stdout","text":["1\n","2\n","3\n","4\n","5\n","6\n","7\n","8\n","9\n","10\n","11\n","12\n","13\n","14\n","15\n","16\n","17\n","18\n","19\n","20\n","21\n","22\n","23\n","24\n","25\n","26\n","27\n","28\n","29\n","30\n","31\n","32\n","33\n","34\n","35\n","36\n","37\n","38\n","39\n","40\n","41\n","42\n","43\n","44\n","45\n","46\n","47\n","48\n","49\n","50\n","51\n","52\n","53\n","54\n","55\n","56\n","57\n","58\n","59\n","60\n","61\n","62\n","63\n","64\n","65\n","66\n","67\n","68\n","69\n","70\n","71\n","72\n","73\n","74\n","75\n","76\n","77\n","78\n","79\n","80\n","81\n","82\n","83\n","84\n","85\n","86\n","87\n","88\n","89\n","90\n","91\n","92\n","93\n","94\n","95\n","96\n","97\n","98\n","99\n","100\n","101\n","102\n","103\n","104\n","105\n","106\n","107\n","108\n","109\n","110\n","111\n","112\n","113\n","114\n","115\n","116\n","117\n","118\n","119\n","120\n","121\n","122\n","123\n","124\n","125\n","126\n","127\n","128\n","129\n","130\n","131\n","132\n","133\n","134\n","135\n","136\n","137\n","138\n","139\n","140\n","141\n","142\n","143\n","144\n","145\n","146\n","147\n","148\n","149\n","150\n","151\n","152\n","153\n","154\n","155\n","156\n","157\n","158\n","159\n","160\n","161\n","162\n","163\n","164\n","165\n","166\n","167\n","168\n","169\n","170\n","171\n","172\n","173\n","174\n","175\n","176\n","177\n","178\n","179\n","180\n","181\n","182\n","183\n","184\n","185\n","186\n","187\n","188\n","189\n","190\n","191\n","192\n","193\n","194\n","195\n","196\n","197\n","198\n","199\n","200\n","201\n","202\n","203\n","204\n","205\n","206\n","207\n","208\n","209\n","210\n","211\n","212\n","213\n","214\n","215\n","216\n","217\n","218\n","219\n","220\n","221\n","222\n","223\n","224\n","225\n","226\n","227\n","228\n","229\n","230\n","231\n","232\n","233\n","234\n","235\n","236\n","237\n","238\n","239\n","240\n","241\n","242\n","243\n","244\n","245\n","246\n","247\n","248\n","249\n","250\n","251\n","252\n","253\n","254\n","255\n","256\n","257\n","258\n","259\n","260\n","261\n","262\n","263\n","264\n","265\n","266\n","267\n","268\n","269\n","270\n","271\n","272\n","273\n","274\n","275\n","276\n","277\n","278\n","279\n","280\n","281\n","282\n","283\n","284\n","285\n","286\n","287\n","288\n","289\n","290\n","291\n","292\n","293\n","294\n","295\n","296\n","297\n","298\n","299\n","300\n","301\n","302\n","303\n","304\n","305\n","306\n","307\n","308\n","309\n","310\n","311\n","312\n","313\n","314\n","315\n","316\n","317\n","318\n","319\n","320\n","321\n","322\n","323\n","324\n","325\n","326\n","327\n","328\n","329\n","330\n","331\n","332\n","333\n","334\n","335\n","336\n","337\n","338\n","339\n","340\n","341\n","342\n","343\n","344\n","345\n","346\n","347\n","348\n","349\n","350\n","351\n","352\n","353\n","354\n","355\n","356\n","357\n","358\n","359\n","360\n","361\n","362\n","363\n","364\n","365\n","366\n","367\n","368\n","369\n","370\n","371\n","372\n","373\n","374\n","375\n","376\n","377\n","378\n","379\n","380\n","381\n","382\n","383\n","384\n","385\n","386\n","387\n","388\n","389\n","390\n","391\n","392\n","393\n","394\n","395\n","396\n","397\n","398\n","399\n","400\n","401\n","402\n","403\n","404\n","405\n","406\n","407\n","408\n","409\n","410\n","411\n","412\n","413\n","414\n","415\n","416\n","417\n","418\n","419\n","420\n","421\n","422\n","423\n","424\n","425\n","426\n","427\n","428\n","429\n","430\n","431\n","432\n","433\n","434\n","435\n","436\n","437\n","438\n","439\n","440\n","441\n","442\n","443\n","444\n","445\n","446\n","447\n","448\n","449\n","450\n","451\n","452\n","453\n","454\n","455\n","456\n","457\n","458\n","459\n","460\n","461\n","462\n","463\n","464\n","465\n","466\n","467\n","468\n","469\n","470\n","471\n","472\n","473\n","474\n","475\n","476\n","477\n","478\n","479\n","480\n","481\n","482\n","483\n","484\n","485\n","486\n","487\n","488\n","489\n","490\n","491\n","492\n","493\n","494\n","495\n","496\n","497\n","498\n","499\n","500\n","501\n","502\n","503\n","504\n","505\n","506\n","507\n","508\n","509\n","510\n","511\n","512\n","513\n","514\n","515\n","516\n","517\n","518\n","519\n","520\n","521\n","522\n","523\n","524\n","525\n","526\n","527\n","528\n","529\n","530\n","531\n","532\n","533\n","534\n","535\n","536\n","537\n","538\n","539\n","540\n","541\n","542\n","543\n","544\n","545\n","546\n","547\n","548\n","549\n","550\n","551\n","552\n","553\n","554\n","555\n","556\n","557\n","558\n","559\n","560\n","561\n","562\n","563\n","564\n","565\n","566\n","567\n","568\n","569\n","570\n","571\n","572\n","573\n","574\n","575\n","576\n","577\n","578\n","579\n","580\n","581\n","582\n","583\n","584\n","585\n","586\n","587\n","588\n","589\n","590\n","591\n","592\n","593\n","594\n","595\n","596\n","597\n","598\n","599\n","600\n","601\n","602\n","603\n","604\n","605\n","606\n","607\n","608\n","609\n","610\n","611\n","612\n","613\n","614\n","615\n","616\n","617\n","618\n","619\n","620\n","621\n","622\n","623\n","624\n","625\n","626\n","627\n","628\n","629\n","630\n","631\n","632\n","633\n","634\n","635\n","636\n","637\n","638\n","639\n","640\n","641\n","642\n","643\n","644\n","645\n","646\n","647\n","648\n","649\n","650\n","651\n","652\n","653\n","654\n","655\n","656\n","657\n","658\n","659\n","660\n","661\n","662\n","663\n","664\n","665\n","666\n","667\n","668\n","669\n","670\n","671\n","672\n","673\n","674\n","675\n","676\n","677\n","678\n","679\n","680\n","681\n","682\n","683\n","684\n","685\n","686\n","687\n","688\n","689\n","690\n","691\n","692\n","693\n","694\n","695\n","696\n","697\n","698\n","699\n","700\n","701\n","702\n","703\n","704\n","705\n","706\n","707\n","708\n","709\n","710\n","711\n","712\n","713\n","714\n","715\n","716\n","717\n","718\n","719\n","720\n","721\n","722\n","723\n","724\n","725\n","726\n","727\n","728\n","729\n","730\n","731\n","732\n","733\n","734\n","735\n","736\n","737\n","738\n","739\n","740\n","741\n","742\n","743\n","744\n","745\n","746\n","747\n","748\n","749\n","750\n","751\n","752\n","753\n","754\n","755\n","756\n","757\n","758\n","759\n","760\n","761\n","762\n","763\n","764\n","765\n","766\n","767\n","768\n","769\n","770\n","771\n","772\n","773\n","774\n","775\n","776\n","777\n","778\n","779\n","780\n","781\n","782\n","783\n","784\n","785\n","786\n","787\n","788\n","789\n","790\n","791\n","792\n","793\n","794\n","795\n","796\n","797\n","798\n","799\n","800\n","801\n","802\n","803\n","804\n","805\n","806\n","807\n","808\n","809\n","810\n","811\n","812\n","813\n","814\n","815\n","816\n","817\n","818\n","819\n","820\n","821\n","822\n","823\n","824\n","825\n","826\n","827\n","828\n","829\n","830\n","831\n","832\n","833\n","834\n","835\n","836\n","837\n","838\n","839\n","840\n","841\n","842\n","843\n","844\n","845\n","846\n","847\n","848\n","849\n","850\n","851\n","852\n","853\n","854\n","855\n","856\n","857\n","858\n","859\n","860\n","861\n","862\n","863\n","864\n","865\n","866\n","867\n","868\n","869\n","870\n","871\n","872\n","873\n","874\n","875\n","876\n","877\n","878\n","879\n","880\n","881\n","882\n","883\n","884\n","885\n","886\n","887\n","888\n","889\n","890\n","891\n","892\n","893\n","894\n","895\n","896\n","897\n","898\n","899\n","900\n","901\n","902\n","903\n","904\n","905\n","906\n","907\n","908\n","909\n","910\n","911\n","912\n","913\n","914\n","915\n","916\n","917\n","918\n","919\n","920\n","921\n","922\n","923\n","924\n","925\n","926\n","927\n","928\n","929\n","930\n","931\n","932\n","933\n","934\n","935\n","936\n","937\n","938\n","939\n","940\n","941\n","942\n","943\n","944\n","945\n","946\n","947\n","948\n","949\n","950\n","951\n","952\n","953\n","954\n","955\n","956\n","957\n","958\n","959\n","960\n","961\n","962\n","963\n","964\n","965\n","966\n","967\n","968\n","969\n","970\n","971\n","972\n","973\n","974\n","975\n","976\n","977\n","978\n","979\n","980\n","981\n","982\n","983\n","984\n","985\n","986\n","987\n","988\n","989\n","990\n","991\n","992\n","993\n","994\n","995\n","996\n","997\n","998\n","999\n","1000\n"]}]},{"cell_type":"code","source":["import pickle\n","\n","with open('/content/drive/MyDrive/phd/models/agnews/explainability/explainable_agnews_bert_deepwordbug.pickle', \"wb\") as handle:\n","    pickle.dump(explain_examples, handle)"],"metadata":{"id":"hOWuuJTltHdR","executionInfo":{"status":"ok","timestamp":1674563157197,"user_tz":-660,"elapsed":291,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}}},"execution_count":26,"outputs":[]},{"cell_type":"code","source":["scores = [0.0,\n","  0.04405593067501031,\n","  0.0031569995525052427,\n","  0.0009389861214753062,\n","  0.04630356247730127,\n","  -0.028147343382499763,\n","  0.12071652248054034,\n","  0.9837541787045914,\n","  0.11299190623724431,\n","  0.0]\n","\n","tokens = ['[CLS]',\n","  'the',\n","  'movie',\n","  'was',\n","  'one',\n","  'of',\n","  'those',\n","  'amazing',\n","  'movies',\n","  '[SEP]']"],"metadata":{"id":"LStMZTjucSTM"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["get_cleaned_lists(scores, tokens)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"VAnpnrhvcOHN","executionInfo":{"status":"ok","timestamp":1674306495365,"user_tz":-660,"elapsed":314,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"outputId":"d408a92b-d2c7-4e61-fe99-32d258714178"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["([0.04405593067501031,\n","  0.0031569995525052427,\n","  0.0009389861214753062,\n","  0.04630356247730127,\n","  -0.028147343382499763,\n","  0.12071652248054034,\n","  0.9837541787045914,\n","  0.11299190623724431],\n"," ['the', 'movie', 'was', 'one', 'of', 'those', 'amazing', 'movies'])"]},"metadata":{},"execution_count":37}]},{"cell_type":"code","metadata":{"id":"T4vlqBBrbUEY","outputId":"15c06385-a82c-455c-d3bc-a9d8aebfc636","executionInfo":{"status":"ok","timestamp":1674303646734,"user_tz":-660,"elapsed":2811,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"colab":{"base_uri":"https://localhost:8080/"}},"source":["# Check predict output\n","predict(input_ids)"],"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["tensor([[-3.2158,  4.0551]], device='cuda:0', grad_fn=<AddmmBackward0>)"]},"metadata":{},"execution_count":15}]},{"cell_type":"code","metadata":{"id":"wpNkwy6_bUEd","outputId":"8189416f-7273-42f4-f2fb-5f4d9372a949","executionInfo":{"status":"ok","timestamp":1674303651293,"user_tz":-660,"elapsed":4,"user":{"displayName":"Harsha Kumara","userId":"15828153382786807383"}},"colab":{"base_uri":"https://localhost:8080/"}},"source":["# Check output of custom_forward\n","custom_forward(input_ids)"],"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["tensor([0.9993], device='cuda:0', grad_fn=<UnsqueezeBackward0>)"]},"metadata":{},"execution_count":16}]},{"cell_type":"markdown","metadata":{"id":"ItXD4N9FogZu"},"source":["The visualization is clearly meaningless! :(\n"]}]}